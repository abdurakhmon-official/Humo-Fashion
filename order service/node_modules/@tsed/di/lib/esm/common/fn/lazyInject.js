import { isFunction } from "@tsed/core/utils/isFunction.js";
import { inject } from "./inject.js";
import { injector } from "./injector.js";
/**
 * Lazy load a provider from his package and invoke only when the provider is used.
 */
export async function lazyInject(factory) {
    const { default: token } = await factory();
    if (!injector().has(token)) {
        const instance = await inject(token);
        const instanceWithHook = instance;
        if ("$onInit" in instanceWithHook && isFunction(instanceWithHook.$onInit)) {
            await instanceWithHook.$onInit();
        }
    }
    return injector().get(token);
}
export async function optionalLazyInject(factory) {
    try {
        return await lazyInject(factory);
    }
    catch (er) {
        return undefined;
    }
}
